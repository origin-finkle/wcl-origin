{{ $player := .player }}
{{ $data := .data }}

<div class="col-12">
    <div class="row">
        <div class="col-12 col-md-6">
            <h4>Gear</h4>
            {{ partial "player/gear" . }}
        </div>
        <div class="col-12 col-md-6">
            <div class="row">
                <div class="col-12">
                    <h4>Auras</h4>
                    <div class="row">
                        {{ range $aura := $data.auras }}
                        <div class="col-12">
                            {{ partial "wowhead" (dict "data-wowhead" (printf "spell=%v" $aura.ability)) }} (#{{ $aura.ability }})
                        </div>
                        {{ end }}
                    </div>
                </div>
                {{ if $data.remarks }}
                <div class="col-12">
                    <h4>Remarques</h4>
                    <div class="row">
                        {{ range $remark := $data.remarks }}
                        <div class="col-12">
                            {{ partialCached "remark" $remark $remark.uuid }}
                        </div>
                        {{ end }}
                    </div>
                </div>
                {{ end }}
                {{ if $data.casts }}
                    {{ $scratch := newScratch }}
                    {{ $scratch.Set "consumables" slice }}
                    {{ $scratch.Set "items" slice }}
                    {{ $scratch.Set "spells" slice }}
                    {{ $scratch.Set "debug" slice }}
                    {{ range $spellID, $count := $data.casts }}
                        {{ $castConfig := index $.Site.Data.config.cast_in_fight $spellID }}
                        {{ if not $castConfig }}
                            {{ $scratch.Add "debug" (dict "data-wowhead" (printf "spell=%v" $spellID) "count" $count "spell_id" $spellID) }}
                        {{ else if eq $castConfig.type "consumable" }}
                            {{ $scratch.Add "consumables" (dict "data-wowhead" (printf "item=%v" $castConfig.item_id) "count" $count "spell_id" $spellID) }}
                        {{ else if eq $castConfig.type "item" }}
                            {{ $scratch.Add "items" (dict "data-wowhead" (printf "item=%v" $castConfig.item_id) "count" $count "spell_id" $spellID) }}
                        {{ else if eq $castConfig.type "spell" }}
                            {{ $scratch.Add "spells" (dict "data-wowhead" (printf "spell=%v" $spellID) "count" $count "spell_id" $spellID) }}
                        {{ end }}
                    {{ end }}
                    <div class="col-12">
                        <h4>Consommables utilisés</h4>
                        <div class="row">
                            {{ range $scratch.Get "consumables" }}
                                <div class="col-12">
                                    {{ .count }} x {{ partial "wowhead" . }} (#{{ .spell_id }})
                                </div>
                            {{ else }}
                                <div class="col-12">
                                    ⛔
                                </div>
                            {{ end }}
                        </div>
                    </div>
                    <div class="col-12">
                        <h4>Items utilisés</h4>
                        <div class="row">
                            {{ range $scratch.Get "items" }}
                                <div class="col-12">
                                    {{ .count }} x {{ partial "wowhead" . }} (#{{ .spell_id }})
                                </div>
                            {{ else }}
                                <div class="col-12">
                                    ⛔
                                </div>
                            {{ end }}
                        </div>
                    </div>
                    <div class="col-12">
                        <h4>Sorts utilisés</h4>
                        <div class="row">
                            {{ range $scratch.Get "spells" }}
                                <div class="col-12">
                                    {{ .count }} x {{ partial "wowhead" . }} (#{{ .spell_id }})
                                </div>
                            {{ else }}
                                <div class="col-12">
                                    ⛔
                                </div>
                            {{ end }}
                        </div>
                    </div>
                    {{ if $scratch.Get "debug" }}
                        <div class="col-12">
                            <h4>Debug</h4>
                            <div class="row">
                                {{ range $scratch.Get "debug" }}
                                    <div class="col-12">
                                        {{ .count }} x {{ partial "wowhead" . }} (#{{ .spell_id }})
                                    </div>
                                {{ end }}
                            </div>
                        </div>
                    {{ end }}
                {{ end }}
            </div>
        </div>
    </div>
</div>